<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toddler Toy Bounce</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden; 
            user-select: none; 
            -webkit-user-select: none; 
            -ms-user-select: none; 
        }
        .emoji-toy {
            transition: transform 0.1s ease-out;
            display: inline-flex; 
            align-items: center;
            justify-content: center;
        }
        .emoji-toy svg { 
            width: 1em; 
            height: 1em;
            display: inline-block;
            vertical-align: -0.125em; 
        }
        .emoji-toy:active {
            transform: scale(0.95); 
        }
        .launched-toy {
            touch-action: none; 
            cursor: pointer; 
            display: inline-flex; 
            align-items: center;
            justify-content: center;
        }
        .launched-toy svg {
             width: 1em; 
             height: 1em;
             display: inline-block;
             vertical-align: -0.125em;
        }
        .particle {
            position: absolute;
            border-radius: 50%;
            z-index: 10; 
            pointer-events: none; 
        }
        .pop-particle { 
            position: absolute;
            border-radius: 50%;
            z-index: 30; 
            pointer-events: none;
        }
        #fullscreenButton {
            z-index: 50; /* Ensure it's above other elements */
        }
    </style>
</head>
<body class="bg-sky-100">

    <div id="gameArea" class="fixed inset-0 z-0">
        </div>

    <button id="fullscreenButton" class="fixed top-4 right-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors">
        Fullscreen
    </button>

    <div id="toyBar" class="fixed bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-blue-300/50 to-blue-200/50 flex justify-around items-center p-2 sm:p-4 z-10 shadow-lg rounded-t-xl">
        </div>

    <div id="countdownDisplay" class="fixed inset-0 flex flex-col justify-center items-center text-8xl sm:text-9xl font-bold text-orange-500 bg-black bg-opacity-75 hidden z-30">
        <span id="countdownText">3</span>
    </div>

    <script type="module">
        const gameArea = document.getElementById('gameArea');
        const toyBar = document.getElementById('toyBar');
        const countdownDisplay = document.getElementById('countdownDisplay');
        const countdownText = document.getElementById('countdownText');
        const fullscreenButton = document.getElementById('fullscreenButton');

        // Game parameters
        const GRAVITY = 0.25; 
        const INITIAL_KICK_VY = -7; 
        const ROCKET_LAUNCH_VY = -25; 
        const HORIZONTAL_KICK_RANGE = 5; 
        const BOUNCE_DAMPING = 0.9; 

        // Star Particle parameters
        const MAX_PARTICLES_PER_STAR = 30;
        const PARTICLE_LIFESPAN = 70; 
        const PARTICLE_SPAWN_INTERVAL = 4; 

        // Pop Particle parameters
        const POP_PARTICLE_COUNT = 15;
        const POP_PARTICLE_LIFESPAN = 40; 
        const POP_PARTICLE_SPEED = 3;

        const rocketSVG = `
            <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2530.6667 3162.6667" height="3162.6667" width="2530.6667" xml:space="preserve" version="1.1"><metadata id="metadata8"><rdf:RDF><cc:Work rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/></cc:Work></rdf:RDF></metadata><defs id="defs6"/><g transform="matrix(1.3333333,0,0,-1.3333333,0,3162.6667)" id="g10"><g transform="scale(0.1)" id="g12"><g transform="scale(1.40995)" id="g14"><path id="path16" style="fill:#dbf4fd;fill-opacity:1;fill-rule:nonzero;stroke:none" d="M 10752.9,6541.98 9243.42,8393.74 c 35.6,287.25 59.79,579.24 69.72,874.36 60.99,1812.9 -429.45,3508.4 -1005.5,4780.3 l -0.07,0.1 c -94.97,209.8 -192.28,408 -289.8,593.3 l -0.07,0.1 c -13.61,25.8 -27.16,51.2 -40.78,76.6 -4.25,7.9 -8.58,15.9 -12.84,23.8 -12.62,23.4 -25.31,46.5 -37.94,69.5 -5.18,9.4 -10.36,18.8 -15.53,28.1 -12.34,22.3 -24.68,44.3 -37.02,66.2 -5.32,9.4 -10.64,18.7 -15.89,28 -12.41,21.7 -24.75,43.3 -37.02,64.5 -5.04,8.6 -10.01,17.1 -14.97,25.6 -12.77,22 -25.6,43.8 -38.3,65.2 -3.61,6 -7.16,11.9 -10.71,17.9 -61.06,102.1 -121.49,198.5 -180.71,288.9 -3.48,5.4 -6.95,10.8 -10.43,16.1 -12.13,18.4 -24.11,36.3 -36.1,54.2 -5.03,7.4 -10,14.9 -15.04,22.3 -11.34,16.8 -22.62,33.3 -33.9,49.6 -5.46,7.9 -10.92,15.8 -16.38,23.6 -10.92,15.7 -21.84,31.2 -32.62,46.5 -5.61,7.8 -11.14,15.5 -16.67,23.3 -10.71,14.9 -21.42,29.8 -31.99,44.3 -5.32,7.3 -10.57,14.3 -15.89,21.5 -10.78,14.6 -21.49,29.2 -32.12,43.2 -4.05,5.5 -8.09,10.6 -12.13,16 -36.1,47.5 -71.35,92.2 -105.61,133.9 -5.6,6.8 -11.28,13.9 -16.88,20.6 -8.51,10.2 -16.88,20 -25.32,29.9 -6.38,7.5 -12.77,15.1 -19.15,22.4 -7.87,9.1 -15.67,18 -23.48,26.7 -6.59,7.5 -13.19,14.9 -19.64,22.1 -7.45,8.2 -14.82,16.3 -22.11,24.2 -6.7,7.2 -13.33,14.3 -19.93,21.2 -6.92,7.3 -13.79,14.6 -20.57,21.6 -6.86,7 -13.58,13.8 -20.31,20.5 -6.31,6.3 -12.67,12.7 -18.87,18.8 -7.36,7.2 -14.53,13.9 -21.71,20.6 -5.31,5 -10.74,10.3 -15.95,15.1 -11.97,10.9 -23.68,21.4 -35.12,31.1 -3.65,3.1 -7.1,5.8 -10.68,8.8 -8.08,6.7 -16.12,13.4 -23.9,19.5 -4.45,3.5 -8.69,6.6 -13.04,9.8 -4.5,3.4 -9.12,7.1 -13.52,10.2 l 0.04,0.1 -0.58,0.3 -5.68,4 c -4.42,3.1 -8.7,5.9 -13.01,8.8 -6.08,4.1 -12.08,8 -17.93,11.6 -4.18,2.6 -8.27,5 -12.35,7.3 -5.7,3.3 -11.27,6.4 -16.73,9.2 -3.83,1.9 -7.63,3.9 -11.34,5.6 l -4.09,2 -1.2,0.6 c -3.67,1.7 -7.08,2.8 -10.64,4.2 l -9.93,3.8 c -3.63,1.2 -7.09,2.2 -10.59,3.1 l -6.77,1.8 -6.31,1.6 c -7.47,1.4 -14.65,2.2 -21.36,2.2 -6.71,0 -13.86,-0.8 -21.37,-2.2 l -7.72,-2 c -5.19,-1.3 -10.42,-2.6 -15.94,-4.5 l -9.93,-3.8 c -5.22,-2.1 -10.47,-4.2 -15.93,-6.8 -3.71,-1.7 -7.52,-3.7 -11.34,-5.6 -5.47,-2.8 -11.03,-5.9 -16.73,-9.2 -4.06,-2.3 -8.15,-4.7 -12.34,-7.3 -5.83,-3.6 -11.85,-7.5 -17.91,-11.6 -4.33,-2.9 -8.61,-5.7 -13.06,-8.8 -6.39,-4.6 -13,-9.5 -19.62,-14.5 -4.39,-3.3 -8.68,-6.4 -13.16,-9.9 -7.75,-6.1 -15.77,-12.7 -23.8,-19.4 -3.61,-3 -7.09,-5.7 -10.76,-8.9 -11.41,-9.7 -23.16,-20.2 -35.12,-31.1 -5.25,-4.8 -10.71,-10.1 -16.09,-15.2 -7.13,-6.7 -14.21,-13.3 -21.52,-20.4 -6.23,-6.2 -12.64,-12.6 -19.03,-19 -6.68,-6.7 -13.36,-13.4 -20.18,-20.4 -6.77,-7 -13.68,-14.3 -20.59,-21.6 -6.58,-6.9 -13.22,-14 -19.93,-21.2 -7.31,-7.9 -14.67,-16 -22.1,-24.2 -6.47,-7.2 -13,-14.5 -19.55,-21.9 -7.85,-8.9 -15.71,-17.8 -23.7,-27 -6.23,-7.2 -12.53,-14.7 -18.82,-22.1 -8.5,-9.9 -16.95,-19.9 -25.59,-30.2 -5.41,-6.5 -10.92,-13.3 -16.37,-20 -34.42,-41.9 -69.82,-86.7 -106.14,-134.5 -4.04,-5.4 -8,-10.5 -12.03,-15.8 -10.68,-14.2 -21.49,-28.8 -32.3,-43.5 -5.22,-7.1 -10.42,-14 -15.65,-21.2 -10.64,-14.6 -21.39,-29.5 -32.14,-44.5 -5.51,-7.7 -11.01,-15.4 -16.54,-23.2 -10.88,-15.3 -21.81,-30.9 -32.8,-46.6 -5.36,-7.8 -10.77,-15.6 -16.18,-23.4 -11.29,-16.4 -22.6,-32.9 -34.01,-49.7 -4.97,-7.4 -9.98,-14.9 -14.98,-22.3 -11.99,-17.9 -24.02,-35.9 -36.12,-54.2 -3.42,-5.2 -6.87,-10.6 -10.26,-15.8 -59.28,-90.5 -119.73,-187 -180.87,-289.2 -3.57,-6 -7.12,-11.9 -10.7,-17.9 -12.79,-21.5 -25.61,-43.4 -38.46,-65.4 -4.91,-8.4 -9.79,-16.7 -14.69,-25.2 -12.41,-21.4 -24.84,-43 -37.27,-64.9 -5.23,-9.2 -10.47,-18.4 -15.71,-27.7 -12.36,-21.9 -24.72,-43.9 -37.11,-66.3 -5.17,-9.3 -10.34,-18.7 -15.53,-28.1 -12.65,-23 -25.3,-46.1 -37.95,-69.5 -4.27,-7.9 -8.54,-15.9 -12.81,-23.8 -13.6,-25.4 -27.2,-50.8 -40.79,-76.6 l -0.07,-0.1 c -79.01,-150.1 -157.84,-308.7 -235.45,-475 l -0.19,-0.4 c -18.14,-38.9 -36.2,-78.2 -54.19,-117.9 l -0.06,-0.1 C 4573.2,12776.5 4082.8,11081 4143.81,9268.1 c 9.95,-295.12 34.11,-587.11 69.69,-874.36 l -1509.51,-1851.76 -46.61,-2919.17 486.07,230.5 237.31,1684.39 1305.66,773.42 C 4876.79,5737.49 5101.5,5216.91 5335.6,4772.99 h -54.9 l 347.79,-618.39 h 15.62 C 5485.48,3489.83 5317.35,1944.74 6724.23,525.266 c 0,0 1612.07,1348.834 1086.3,3629.334 h 17.95 l 347.74,618.39 h -54.76 l 5.54,10.71 c 13.76,26.24 27.52,52.77 41.27,79.58 9.51,18.65 19.08,37.23 28.59,56.1 14.11,28.01 28.15,56.45 42.13,85.04 8.93,18.15 17.87,36.09 26.66,54.47 15.39,31.91 30.71,64.32 45.96,96.81 7.31,15.67 14.68,31.06 21.99,46.81 22.27,48.15 44.4,96.88 66.31,146.38 l 0.57,1.28 c 132.06,298.24 257.03,620.45 370.01,960.95 l 1305.71,-773.42 237.3,-1684.39 486.1,-230.5 -46.7,2919.17"/></g><path id="path18" style="fill:#dbe926;fill-opacity:1;fill-rule:nonzero;stroke:none" d="M 11012.7,5857.8 H 9862.11 L 9746.49,5108 h -519.33 l -115.62,749.8 H 8374.59 7957.94 C 7734.28,4920.5 7497.22,2742 9480.86,740.602 c 0,0 2273.24,1901.698 1531.84,5117.198"/><path id="path20" style="fill:#d43e39;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 15161.1,9223.9 -2127.9,2610.4 c -90.2,-728.2 -234.3,-1433.9 -415.2,-2100.9 -77.5,-285.9 -161.9,-564.8 -251.6,-835.2 L 14207,7807.9 14541.5,5433 l 685.4,-325 -65.8,4115.9"/><path id="path22" style="fill:#d43e39;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 6355.65,9733.4 c -180.92,667 -324.98,1372.7 -415.23,2100.9 L 3812.5,9223.9 3746.79,5108 l 685.33,325 334.6,2374.9 1840.57,1090.3 c -89.77,270.4 -174.1,549.3 -251.64,835.2"/><g transform="scale(1.40995)" id="g24"><path id="path26" style="fill:#d43e39;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 8017.77,14641.8 c -438.59,833 -882.08,1405.4 -1140.82,1592.1 h -0.08 l -4.51,3.3 -1.79,1.2 -4.5,3.2 -1.33,0.9 -9.89,6.7 h -0.06 l -4.13,2.7 -2.09,1.4 -3.88,2.5 -2.11,1.3 c -4.28,2.7 -8.52,5.2 -12.69,7.7 l -2.28,1.3 -3.41,1.9 -0.25,0.2 -2.02,1.1 -0.46,0.3 -3,1.6 -3.34,1.8 -1.73,0.9 -3.13,1.7 -2.63,1.3 -2.91,1.4 -2.84,1.4 -2.81,1.4 -0.79,0.3 -3.03,1.4 -1.13,0.5 -2.3,1 -0.16,0.1 -2.96,1.3 -2.44,1 -2.16,0.8 -0.96,0.4 -2.19,0.9 -3.45,1.3 -1.45,0.5 -1.73,0.6 -3.39,1.1 -2.11,0.7 h -0.02 l -3.35,1 -1.57,0.5 -0.95,0.3 -2.91,0.8 -0.95,0.2 -1.33,0.3 -3.46,0.8 -1.84,0.4 -1.41,0.3 -0.27,0.1 -1.62,0.3 -1.36,0.2 -1.92,0.3 -1.34,0.2 -1.29,0.2 h -0.04 l -0.64,0.1 -3.05,0.4 h -0.06 l -0.81,0.1 -1.33,0.1 -2.87,0.2 h -0.46 l -1.2,0.1 -4.32,0.1 -5.12,-0.2 -1.68,-0.1 -3.59,-0.3 -2.01,-0.2 -3.42,-0.4 -2.26,-0.4 -3.22,-0.6 -2.45,-0.4 -3.42,-0.8 -2.31,-0.5 -3.61,-1 -2.38,-0.6 -4.56,-1.4 -1.36,-0.4 -6.06,-2 -2.56,-1 -3.73,-1.4 -2.92,-1.2 -3.47,-1.4 -3.15,-1.3 -3.34,-1.5 -3.38,-1.6 -3.27,-1.5 -3.53,-1.7 -3.06,-1.6 -3.86,-1.9 -2.71,-1.5 c -5.24,-2.8 -10.6,-5.7 -16.08,-9 l -1.8,-1 -4.97,-3 -2.26,-1.4 -5,-3.1 -2.38,-1.6 -5.14,-3.3 -2,-1.3 -5.8,-3.9 -1.15,-0.8 c -256.28,-174.5 -708.84,-753.1 -1156.3,-1602.9 14.27,2.5 28.56,4.9 42.89,7.3 4.1,0.7 8.21,1.4 12.33,2.1 10.62,1.7 21.25,3.5 31.89,5.2 4.15,0.7 8.29,1.3 12.44,2 10.95,1.7 21.94,3.5 32.93,5.2 3.75,0.5 7.48,1.1 11.21,1.7 13.96,2.1 27.95,4.2 41.95,6.3 l 0.77,0.1 c 31.22,4.6 62.59,9 94.1,13.2 l 0.69,0.1 c 15.14,2 30.32,4 45.53,5.9 l 3.21,0.4 c 15.26,1.9 30.56,3.8 45.9,5.7 h 0.19 c 293.92,35.3 599.51,54 913.28,54 450,0 883.27,-38.4 1289.31,-109.2"/></g><g transform="scale(1.23867)" id="g28"><path id="path30" style="fill:#d43e39;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 9394.54,16125.9 c -546.07,114.2 -1132.35,174.1 -1735.63,174.1 -448.91,0 -888.41,-33.2 -1308.93,-97.2 -71.9,-11 -143.23,-22.8 -213.95,-35.6 l -1.38,-0.2 c -17.11,-3.1 -34.19,-6.2 -51.24,-9.4 l -2.02,-0.4 c -16.12,-3 -32.19,-6.1 -48.26,-9.2 l -4.91,-0.9 c -15.17,-3 -30.3,-6 -45.43,-9.1 l -7.3,-1.4 c -17.43,-3.5 -34.82,-7.1 -52.19,-10.7 -20.74,-44.5 -41.41,-89.4 -61.97,-134.8 17.36,3.8 34.74,7.6 52.18,11.3 l 0.42,0.1 c 17.35,3.7 34.74,7.3 52.17,10.9 l 0.67,0.1 c 34.93,7.2 70.03,14.2 105.3,20.9 l 1.1,0.2 c 35.22,6.7 70.61,13.2 106.13,19.5 l 1.13,0.2 c 35.66,6.2 71.47,12.3 107.45,18.1 l 0.39,0.1 c 438.67,70.9 899.31,107.7 1370.64,107.7 626.94,0 1235.01,-65 1797.55,-189.1 -20.58,45.4 -41.25,90.3 -61.92,134.8"/></g><g transform="scale(1.12528)" id="g32"><path id="path34" style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 8430.66,16300 c -1021.16,0 -1848.98,-827.8 -1848.98,-1849 0,-1021.1 827.82,-1848.9 1848.98,-1848.9 1021.14,0 1849.04,827.8 1849.04,1848.9 0,1021.2 -827.9,1849 -1849.04,1849"/></g><g transform="scale(1.10304)" id="g36"><path id="path38" style="fill:#406ebf;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 9054.29,13251.8 4.04,1.3 c 5.24,1.6 10.5,3.2 15.67,4.9 l 2.18,0.7 c 12.5,4 24.84,8.1 37.17,12.4 l 0.81,0.3 c 5.99,2.1 11.97,4.2 17.86,6.3 l 0.82,0.4 c 598.16,217.5 1025.46,790.9 1025.46,1464.3 0,860.2 -697.37,1557.6 -1557.69,1557.6 -680.16,0 -1258.44,-435.9 -1470.82,-1043.6 l -0.19,-0.6 c -4.3,-12.4 -8.48,-24.7 -12.47,-37.2 l -0.69,-2.2 c -1.63,-5.1 -3.24,-10.2 -4.82,-15.4 l -1.43,-4.7 -4.08,-13.6 -1.35,-4.6 c -1.73,-6 -3.42,-11.9 -5.11,-17.9 l -0.59,-2.2 c -3.22,-11.6 -6.3,-23.3 -9.27,-35.1 l -0.97,-4 -2.65,-10.8 -0.96,-4 c -1.42,-5.9 -2.8,-11.9 -4.16,-17.9 l -1.48,-6.7 -1.92,-8.8 -1.73,-8.1 -2.4,-11.7 -2.07,-10.5 -1.53,-8 -1.63,-8.9 -1.38,-7.6 c -0.91,-5.1 -1.78,-10.2 -2.65,-15.3 l -0.93,-5.7 -1.8,-11.5 -0.94,-6 c -0.81,-5.4 -1.6,-10.8 -2.37,-16.2 l -0.57,-4.2 -1.82,-13.6 -0.62,-4.8 c -0.72,-5.6 -1.42,-11.3 -2.05,-17 l -0.13,-1.2 c -0.64,-5.6 -1.26,-11.2 -1.83,-16.9 l -0.42,-4 c -0.51,-5.4 -1.03,-10.8 -1.52,-16.1 l -0.18,-1.9 c -0.52,-6 -1.01,-12 -1.48,-18 l -0.24,-3.4 c -0.4,-5.2 -0.76,-10.5 -1.1,-15.7 l -0.19,-2.9 c -0.4,-6.1 -0.74,-12.2 -1.03,-18.2 l -0.13,-2.5 c -0.27,-5.3 -0.5,-10.7 -0.72,-16.1 l -0.15,-3.5 c -0.22,-6.1 -0.42,-12.2 -0.56,-18.4 l -0.03,-1.1 c -0.15,-5.7 -0.25,-11.4 -0.32,-17.1 l -0.07,-4 c -0.05,-6.1 -0.11,-12.1 -0.11,-18.2 0,-133.1 16.7,-262.3 48.1,-385.6 l 2.23,-8.7 c 3.97,-15.1 8.15,-30.2 12.57,-45.3 l 3.26,-10.9 c 8,-26.5 16.69,-52.8 26.05,-78.7 2.94,-8.1 5.89,-16.2 8.96,-24.3 16.94,-44.5 35.87,-88 56.66,-130.5 2.77,-5.6 5.57,-11.2 8.38,-16.8 2.76,-5.5 5.55,-11 8.37,-16.4 6,-11.5 12.15,-23 18.44,-34.4 2.67,-4.8 5.36,-9.7 8.11,-14.5 3.51,-6.3 7.13,-12.5 10.76,-18.7 l 7.82,-13.3 c 3.9,-6.5 7.88,-13 11.85,-19.5 8.97,-14.5 18.13,-28.8 27.51,-42.9 4.69,-7.1 9.41,-14.1 14.2,-21 40.07,-58.3 83.97,-113.7 131.38,-165.9 12.57,-13.8 25.39,-27.4 38.45,-40.8 8.63,-8.8 17.41,-17.6 26.28,-26.3 17.87,-17.4 36.17,-34.4 54.85,-51 4.67,-4.2 9.34,-8.3 14.05,-12.4 9.43,-8.1 18.94,-16.2 28.58,-24.1 4.78,-4 9.62,-7.9 14.49,-11.8 9.71,-7.8 19.51,-15.6 29.41,-23.1 4.96,-3.8 9.92,-7.6 14.94,-11.4 9.96,-7.4 20.07,-14.8 30.24,-22 5.09,-3.6 10.2,-7.2 15.33,-10.8 10.28,-7.1 20.64,-14.1 31.09,-21 10.44,-6.8 20.99,-13.6 31.6,-20.2 10.62,-6.7 21.32,-13.2 32.11,-19.6 10.78,-6.3 21.68,-12.6 32.62,-18.7 16.44,-9.2 33.06,-18.1 49.85,-26.7 11.18,-5.7 22.46,-11.3 33.8,-16.8 34.05,-16.4 68.79,-31.6 104.17,-45.6 17.68,-6.9 35.54,-13.6 53.51,-19.9 17.99,-6.4 36.14,-12.4 54.45,-18.1 12.2,-3.8 24.44,-7.4 36.76,-10.9 6.15,-1.8 12.35,-3.5 18.51,-5.1 11.14,-3.1 22.35,-5.9 33.59,-8.7 7.51,-1.9 15.01,-3.7 22.55,-5.4 6.29,-1.5 12.59,-2.9 18.88,-4.2 12.62,-2.8 25.28,-5.4 38.02,-7.8 95.48,-18.3 194.06,-27.9 294.88,-27.9 5.92,0 11.84,0.1 17.78,0.1 l 5,0.1 c 5.2,0.1 10.34,0.2 15.51,0.3 h 2.49 c 5.91,0.2 11.77,0.4 17.65,0.6 l 4.6,0.2 c 4.86,0.2 9.73,0.4 14.62,0.6 l 3.62,0.2 c 5.83,0.3 11.66,0.6 17.49,1 l 4.09,0.3 c 4.78,0.3 9.54,0.6 14.3,1 l 4.45,0.3 c 5.75,0.5 11.5,0.9 17.23,1.4 l 3.28,0.3 c 4.83,0.4 9.61,0.9 14.43,1.4 l 5.14,0.5 c 4.97,0.5 9.97,1 14.96,1.6 l 4.19,0.5 c 5,0.6 9.96,1.2 14.93,1.8 l 5.89,0.7 12.05,1.7 5.5,0.7 c 5.2,0.7 10.35,1.5 15.53,2.3 l 6.57,1 10.87,1.7 6.41,1.1 c 4.9,0.8 9.76,1.6 14.63,2.5 l 8.74,1.6 7.45,1.4 9.06,1.7 7.51,1.5 c 5.11,1 10.22,2 15.34,3.1 l 6.54,1.4 9.81,2.1 4.85,1.1 c 7.04,1.6 14.08,3.2 21.09,4.9 l 1.75,0.4 11.76,2.9 2.55,0.6 c 12.26,3.1 24.48,6.3 36.66,9.7 l 0.81,0.2 c 5.98,1.7 11.9,3.4 17.83,5.1 l 4.75,1.4 c 4.66,1.4 9.33,2.7 13.97,4.1"/></g><path id="path40" style="fill:#d7742d;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 9227.16,5108 -115.62,749.8 h -736.95 c -60.24,-760.8 78.45,-1891.9 1106.27,-2928.7 0,0 1267.54,1103.3 1127.64,2928.7 H 9862.11 L 9746.49,5108 h -519.33"/><path id="path42" style="fill:#a9322d;fill-opacity:1;fill-rule:nonzero;stroke:none" d="M 14727.4,5610 14392.8,8147.1 12618,9733.4 c -77.5,-285.9 -161.9,-564.8 -251.6,-835.2 L 14207,7807.9 14541.5,5433 l 685.4,-325 -499.5,502"/><path id="path44" style="fill:#a9322d;fill-opacity:1;fill-rule:nonzero;stroke:none" d="M 4580.83,8147.1 4246.24,5610 l -499.45,-502 685.33,325 334.6,2374.9 1840.57,1090.3 c -89.77,270.4 -174.1,549.3 -251.64,835.2 L 4580.83,8147.1"/><g transform="scale(1.18479)" id="g46"><path id="path48" style="fill:#f5fcfe;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 9830.46,14908 c 123.65,-479 239.14,-960.7 320.74,-1448.9 165.9,-993.6 228.4,-2005.5 170.7,-3011.5 -36.9,-660.69 -123,-1322.07 -221.8,-1996.46 11,74.87 82.1,170.16 113.5,240.22 38.5,86.09 75.3,172.85 110.1,260.38 67.5,169.23 128.1,341.16 181.9,515.2 347.9,1125.56 408.9,2330.76 228.7,3492.36 -183.5,1183.5 -610.2,2355.5 -1297.58,3340.7 113.36,-213.7 141.97,-433 202.66,-664.3 63.63,-242.6 128.46,-484.8 191.08,-727.7"/></g><path id="path50" style="fill:#bbdaee;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 10125,7562.9 -128.46,-833.2 h 1454.56 l 7.7,14.6 4.1,7.8 c 6.4,12.3 12.9,24.6 19.3,37 l 4.2,8.1 c 6.5,12.5 13,25.1 19.5,37.7 l 3.7,7.2 c 6.8,13.2 13.6,26.4 20.3,39.7 l 1.6,3.1 c 6.9,13.4 13.7,27 20.6,40.5 l 1.7,3.4 c 6.5,13 13.1,26 19.6,39.1 l 4.5,9 c 6.3,12.7 12.7,25.4 19,38.2 l 4,8 c 6.4,13.1 12.9,26.1 19.3,39.3 l 3.9,7.9 c 6.2,12.8 12.5,25.6 18.7,38.5 l 3.1,6.4 c 6.2,12.7 12.3,25.4 18.5,38.2 l 3.5,7.4 c 6.3,13.1 12.6,26.4 19,39.6 l 4.3,9.2 c 6.4,13.4 12.7,26.8 19.1,40.3 l 3.5,7.6 c 6.5,13.8 13,27.6 19.5,41.5 l 2.7,6 c 6,12.8 11.9,25.6 17.9,38.5 l 3.3,7.1 c 6.3,13.7 12.6,27.4 18.9,41.2 l 3.9,8.4 c 6.1,13.5 12.2,27 18.3,40.5 l 4.9,10.7 c 6,13.3 12,26.8 18,40.2 l 3.9,8.7 c 6.1,13.6 12.2,27.2 18.2,40.9 l 1,2.3 -1719.3,19.4"/><g transform="scale(1.22138)" id="g52"><path id="path54" style="fill:#bbdaee;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 7240.5,6220.03 -358.91,10.48 C 6100.21,7450.77 5326.14,9503.7 5311.18,11686.6 c -11.82,1722.3 468.78,3332 1066.1,4613.4 l -0.39,-0.1 c -36.49,-5.9 -72.81,-12 -108.97,-18.4 l -1.15,-0.2 c -36.03,-6.3 -71.91,-12.9 -107.63,-19.7 l -1.12,-0.2 c -35.77,-6.8 -71.36,-13.9 -106.79,-21.2 l -0.67,-0.1 c -17.68,-3.6 -35.32,-7.3 -52.91,-11.1 l -0.43,-0.1 c -17.62,-3.7 -35.2,-7.5 -52.73,-11.4 C 5279.4,14749.2 4713.18,12792 4783.61,10699.1 c 11.48,-340.9 38.98,-678.2 80.1,-1009.79 73.89,-596.21 191.84,-1174 339.96,-1720.11 63.49,-234.08 132.54,-462.43 206.03,-683.82 219.7,-662.04 479.22,-1263.08 749.4,-1775.45 h 1190.89 l -109.49,710.1"/></g><g transform="scale(1.27129)" id="g56"><path id="path58" style="fill:#bbdaee;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 5771.28,15712 c 16.93,3.5 33.87,7 50.86,10.5 l 7.11,1.4 c 14.74,2.9 29.48,5.9 44.26,8.8 l 4.78,0.9 c 15.66,3 31.33,6 47.02,9 l 1.98,0.3 c 16.6,3.1 33.25,6.2 49.92,9.2 l 1.35,0.2 c 68.9,12.4 138.4,24 208.46,34.6 85.68,178.3 173.54,349.6 262.43,513.1 h -0.21 c -17.01,-2.1 -33.98,-4.2 -50.9,-6.3 l -3.57,-0.4 c -16.86,-2.2 -33.69,-4.4 -50.49,-6.6 l -0.77,-0.1 c -34.94,-4.7 -69.73,-9.5 -104.36,-14.6 l -0.85,-0.2 c -15.53,-2.2 -31.04,-4.6 -46.53,-6.9 -4.14,-0.7 -8.27,-1.3 -12.43,-2 -12.19,-1.8 -24.38,-3.8 -36.53,-5.7 -4.6,-0.7 -9.2,-1.5 -13.79,-2.2 -11.81,-1.9 -23.59,-3.8 -35.37,-5.8 -4.56,-0.8 -9.13,-1.5 -13.67,-2.3 -15.88,-2.6 -31.73,-5.3 -47.52,-8.1 -88.87,-168.8 -177.51,-347.2 -264.75,-534.4 h 0.06 l 3.51,7.6"/></g><path id="path60" style="fill:#515165;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 9111.54,5857.8 -134.43,871.9 H 7445.55 l 490.36,-871.9 h 22.03 416.65 736.95"/><path id="path62" style="fill:#515165;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 9996.54,6729.7 -134.43,-871.9 h 1175.69 l 490.3,871.9 h -77 -1454.56"/><g transform="scale(1.40995)" id="g64"><path id="path66" style="fill:#a9322d;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 5439.15,14641.8 c 14.27,2.5 28.56,4.9 42.89,7.3 4.1,0.7 8.21,1.4 12.33,2.1 10.62,1.7 21.25,3.5 31.89,5.2 4.15,0.7 8.29,1.3 12.44,2 10.95,1.7 21.94,3.5 32.93,5.2 3.75,0.5 7.48,1.1 11.21,1.7 13.96,2.1 27.95,4.2 41.95,6.3 l 0.77,0.1 c 31.22,4.6 62.59,9 94.1,13.2 l 0.69,0.1 c 15.14,2 30.32,4 45.53,5.9 l 3.21,0.4 c 15.26,1.9 30.56,3.8 45.9,5.7 h 0.19 c 368.51,678.1 756.23,1209.8 1061.77,1536.9 h -0.08 l -4.51,3.3 -1.79,1.2 -4.5,3.2 -1.33,0.9 -9.89,6.7 h -0.06 l -4.13,2.7 -2.09,1.4 -3.88,2.5 -2.11,1.3 c -4.28,2.7 -8.52,5.2 -12.69,7.7 l -2.28,1.3 -3.41,1.9 -0.25,0.2 -2.02,1.1 -0.46,0.3 -3,1.6 -3.34,1.8 -1.73,0.9 -3.13,1.7 -2.63,1.3 -2.91,1.4 -2.84,1.4 -2.81,1.4 -0.79,0.3 -3.03,1.4 -1.13,0.5 -2.3,1 -0.16,0.1 -2.96,1.3 -2.44,1 -2.16,0.8 -0.96,0.4 -2.19,0.9 -3.45,1.3 -1.45,0.5 -1.73,0.6 -3.39,1.1 -2.11,0.7 h -0.02 l -3.35,1 -1.57,0.5 -0.95,0.3 -2.91,0.8 -0.95,0.2 -1.33,0.3 -3.46,0.8 -1.84,0.4 -1.41,0.3 -0.27,0.1 -1.62,0.3 -1.36,0.2 -1.92,0.3 -1.34,0.2 -1.29,0.2 h -0.04 l -0.64,0.1 -3.05,0.4 h -0.06 l -0.81,0.1 -1.33,0.1 -2.87,0.2 h -0.46 l -1.2,0.1 -4.32,0.1 -5.12,-0.2 -1.68,-0.1 -3.59,-0.3 -2.01,-0.2 -3.42,-0.4 -2.26,-0.4 -3.22,-0.6 -2.45,-0.4 -3.42,-0.8 -2.31,-0.5 -3.61,-1 -2.38,-0.6 -4.56,-1.4 -1.36,-0.4 -6.06,-2 -2.56,-1 -3.73,-1.4 -2.92,-1.2 -3.47,-1.4 -3.15,-1.3 -3.34,-1.5 -3.38,-1.6 -3.27,-1.5 -3.53,-1.7 -3.06,-1.6 -3.86,-1.9 -2.71,-1.5 c -5.24,-2.8 -10.6,-5.7 -16.08,-9 l -1.8,-1 -4.97,-3 -2.26,-1.4 -5,-3.1 -2.38,-1.6 -5.14,-3.3 -2,-1.3 -5.8,-3.9 -1.15,-0.8 c -256.28,-174.5 -708.84,-753.1 -1156.3,-1602.9"/></g><g transform="scale(1.23128)" id="g68"><path id="path70" style="fill:#a9322d;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 6326.01,16168.9 c 20.57,44.1 41.26,87.8 62.08,131.1 -72.32,-11 -144.07,-22.9 -215.23,-35.7 l -1.4,-0.3 c -17.21,-3.1 -34.39,-6.2 -51.54,-9.4 l -2.04,-0.4 c -16.21,-3.1 -32.38,-6.2 -48.55,-9.3 l -4.94,-0.9 c -15.26,-3 -30.48,-6.1 -45.7,-9.1 l -7.34,-1.5 c -17.53,-3.5 -35.03,-7.1 -52.51,-10.8 -20.85,-44.7 -41.65,-89.8 -62.34,-135.5 17.46,3.8 34.96,7.6 52.5,11.3 l 0.42,0.1 c 17.46,3.8 34.95,7.4 52.49,11 l 0.66,0.1 c 35.15,7.3 70.46,14.3 105.94,21 l 1.1,0.2 c 35.44,6.8 71.04,13.3 106.77,19.6 l 1.14,0.2 c 35.87,6.3 71.9,12.4 108.1,18.3 h 0.39"/></g><g transform="scale(1.1199)" id="g72"><path id="path74" style="fill:#bbdaee;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 8471.16,16110.6 c 52.28,0 94.67,42.4 94.67,94.7 0,52.3 -42.39,94.7 -94.67,94.7 -52.3,0 -94.67,-42.4 -94.67,-94.7 0,-52.3 42.37,-94.7 94.67,-94.7"/></g><path id="path76" style="fill:#bbdaee;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 9486.83,14480.6 c -58.57,0 -106.03,-47.4 -106.03,-106 0,-58.6 47.46,-106 106.03,-106 58.55,0 106.02,47.4 106.02,106 0,58.6 -47.47,106 -106.02,106"/><g transform="scale(1.00414)" id="g78"><path id="path80" style="fill:#bbdaee;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 11326.8,16300 c -58.3,0 -105.6,-47.3 -105.6,-105.6 0,-58.3 47.3,-105.6 105.6,-105.6 58.3,0 105.6,47.3 105.6,105.6 0,58.3 -47.3,105.6 -105.6,105.6"/></g><g transform="scale(1.00414)" id="g82"><path id="path84" style="fill:#bbdaee;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 7568.66,16300 c -58.31,0 -105.6,-47.3 -105.6,-105.6 0,-58.3 47.29,-105.6 105.6,-105.6 58.31,0 105.59,47.3 105.59,105.6 0,58.3 -47.28,105.6 -105.59,105.6"/></g><g transform="scale(1.08663)" id="g86"><path id="path88" style="fill:#bbdaee;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 10027.4,16123.9 c 38.1,38.1 38.1,99.9 0,138 -38.14,38.1 -99.89,38.1 -137.99,0 -38.19,-38.1 -38.19,-99.9 0,-138 38.1,-38.1 99.85,-38.1 137.99,0"/></g><path id="path90" style="fill:#bbdaee;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 8077.67,15002.2 c -41.43,-41.4 -41.43,-108.5 0,-149.9 41.4,-41.4 108.53,-41.4 149.94,0 41.38,41.4 41.38,108.5 0,149.9 -41.41,41.4 -108.54,41.4 -149.94,0"/><path id="path92" style="fill:#bbdaee;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 10746.1,15002.2 c -41.5,-41.4 -41.5,-108.5 0,-149.9 41.4,-41.4 108.5,-41.4 149.9,0 41.4,41.4 41.4,108.5 0,149.9 -41.4,41.4 -108.5,41.4 -149.9,0"/><g transform="scale(1.08663)" id="g94"><path id="path96" style="fill:#bbdaee;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 7571.7,16123.9 c 38.08,38.1 38.08,99.9 0,138 -38.11,38.1 -99.89,38.1 -137.99,0 -38.13,-38.1 -38.13,-99.9 0,-138 38.1,-38.1 99.88,-38.1 137.99,0"/></g><g transform="scale(1.09072)" id="g98"><path id="path100" style="fill:#2a4994;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 9349.53,13985.4 c -869.96,0 -1575.23,705.3 -1575.23,1575.3 0,267.2 66.77,518.8 184.18,739.3 -376.51,-200.5 -662.1,-549.3 -778.61,-968.5 l -0.59,-2.2 c -3.26,-11.8 -6.38,-23.6 -9.37,-35.5 l -0.99,-4 -2.68,-11 -0.97,-4 c -1.44,-6 -2.83,-12.1 -4.2,-18.2 l -1.51,-6.7 -1.94,-8.9 -1.74,-8.2 -2.43,-11.9 -2.09,-10.5 -1.55,-8.2 -1.65,-9 -1.39,-7.6 c -0.93,-5.2 -1.81,-10.3 -2.68,-15.5 l -0.95,-5.8 -1.82,-11.6 -0.95,-6 c -0.82,-5.5 -1.62,-11 -2.4,-16.4 l -0.58,-4.3 -1.84,-13.7 -0.62,-4.9 c -0.72,-5.7 -1.43,-11.5 -2.07,-17.2 l -0.13,-1.2 c -0.65,-5.7 -1.27,-11.4 -1.85,-17.1 l -0.43,-4.1 c -0.52,-5.4 -1.04,-10.8 -1.54,-16.2 l -0.18,-1.9 c -0.52,-6.1 -1.02,-12.1 -1.49,-18.2 l -0.25,-3.5 c -0.4,-5.2 -0.77,-10.6 -1.11,-15.9 l -0.19,-2.9 c -0.4,-6.1 -0.76,-12.3 -1.05,-18.4 l -0.12,-2.5 c -0.28,-5.4 -0.51,-10.8 -0.73,-16.3 l -0.16,-3.6 c -0.22,-6.2 -0.42,-12.3 -0.57,-18.6 l -0.02,-1.1 c -0.15,-5.7 -0.25,-11.5 -0.32,-17.2 l -0.08,-4.1 c -0.05,-6.2 -0.11,-12.3 -0.11,-18.5 0,-134.5 16.89,-265.2 48.65,-389.9 l 2.25,-8.7 c 4.01,-15.4 8.24,-30.7 12.71,-45.8 l 3.29,-11.1 c 8.1,-26.8 16.88,-53.4 26.35,-79.6 2.98,-8.2 5.96,-16.4 9.06,-24.5 17.14,-45.1 36.28,-89.1 57.31,-132.1 2.8,-5.6 5.62,-11.3 8.46,-16.9 2.8,-5.6 5.62,-11.1 8.48,-16.6 6.06,-11.7 12.28,-23.3 18.65,-34.8 2.69,-4.9 5.42,-9.8 8.19,-14.7 3.56,-6.3 7.22,-12.6 10.88,-18.9 l 7.92,-13.4 c 3.94,-6.6 7.96,-13.2 11.98,-19.7 9.07,-14.7 18.33,-29.2 27.82,-43.5 4.74,-7.1 9.51,-14.2 14.36,-21.2 40.53,-59 84.92,-115 132.87,-167.7 12.71,-14 25.67,-27.8 38.87,-41.3 8.74,-8.9 17.61,-17.8 26.58,-26.6 18.07,-17.6 36.58,-34.8 55.48,-51.6 4.72,-4.2 9.44,-8.4 14.2,-12.5 9.54,-8.3 19.16,-16.4 28.91,-24.4 4.83,-4 9.73,-8 14.65,-12 9.82,-7.9 19.73,-15.7 29.74,-23.3 5.02,-3.9 10.03,-7.7 15.11,-11.5 10.08,-7.5 20.3,-15 30.58,-22.3 5.15,-3.6 10.32,-7.3 15.51,-10.9 10.4,-7.2 20.87,-14.3 31.44,-21.2 10.56,-7 21.22,-13.8 31.96,-20.5 10.73,-6.7 21.55,-13.3 32.46,-19.7 10.91,-6.5 21.93,-12.8 32.99,-19 16.63,-9.3 33.44,-18.3 50.42,-27 11.3,-5.8 22.72,-11.4 34.18,-17 34.43,-16.6 69.57,-32 105.35,-46.1 17.88,-7 35.94,-13.7 54.11,-20.2 18.2,-6.4 36.56,-12.4 55.06,-18.2 12.35,-3.8 24.72,-7.5 37.18,-11.1 6.22,-1.7 12.49,-3.4 18.72,-5.1 11.27,-3.1 22.6,-6 33.97,-8.8 7.59,-1.9 15.19,-3.7 22.8,-5.5 6.37,-1.5 12.74,-2.9 19.1,-4.2 12.76,-2.8 25.57,-5.5 38.45,-7.9 96.56,-18.5 196.26,-28.2 298.21,-28.2 5.99,0 11.97,0 17.98,0.1 l 5.06,0.1 c 5.25,0.1 10.46,0.1 15.69,0.3 h 2.52 c 5.97,0.2 11.9,0.4 17.85,0.6 l 4.65,0.2 c 4.91,0.2 9.83,0.4 14.78,0.6 l 3.66,0.2 c 5.9,0.3 11.79,0.6 17.69,1 l 4.14,0.3 c 4.83,0.3 9.64,0.6 14.45,1 l 4.5,0.3 c 5.82,0.5 11.64,0.9 17.43,1.5 l 3.32,0.3 c 4.88,0.4 9.72,0.9 14.59,1.4 l 5.2,0.5 c 5.03,0.5 10.08,1 15.13,1.6 l 4.24,0.5 c 5.05,0.6 10.07,1.2 15.1,1.8 l 5.95,0.8 12.19,1.6 5.56,0.8 c 5.25,0.7 10.47,1.5 15.7,2.3 l 6.65,1 11,1.7 6.48,1.1 c 4.95,0.8 9.86,1.7 14.79,2.5 l 8.84,1.7 7.53,1.4 9.17,1.7 7.59,1.5 c 5.17,1 10.34,2.1 15.51,3.1 l 6.62,1.5 9.91,2.1 4.92,1.1 c 7.11,1.6 14.24,3.3 21.32,5 l 1.77,0.4 11.89,2.9 2.58,0.6 c 12.4,3.1 24.76,6.4 37.08,9.8 l 0.81,0.3 c 419.51,116.3 768.54,402 969.27,778.8 -220.53,-117.5 -472.11,-184.3 -739.37,-184.3"/></g><path id="path102" style="fill:#a9322d;fill-opacity:1;fill-rule:nonzero;stroke:none" d="M 10188.7,12705.1 H 8784.9 L 8592.53,9223.9 8843.38,7597 8977.11,6729.7 9111.54,5857.8 9227.16,5108 h 519.33 l 115.62,749.8 134.43,871.9 128.46,833.2 256.1,1661 -192.4,3481.2"/><path id="path104" style="fill:#d43e39;fill-opacity:1;fill-rule:nonzero;stroke:none" d="m 9330.52,5153.7 h 312.61 l 381.97,4053.2 129,3428 H 8819.55 l 129.01,-3428 381.96,-4053.2"/></g></g></svg>
        `;

        const toyDefinitions = [
            { id: 'bear', emoji: '🧸', isRocket: false, movementType: 'bounce' },
            { id: 'ball', emoji: '⚽️', isRocket: false, movementType: 'bounce' },
            { id: 'rocket', emoji: rocketSVG, isRocket: true, movementType: 'bounce' },
            { id: 'car', emoji: '🚗', isRocket: false, movementType: 'bounce' },
            { id: 'balloon', emoji: '🎈', isRocket: false, movementType: 'float_gentle' },
            { id: 'star', emoji: '🌟', isRocket: false, movementType: 'float_drift', particleEffect: 'trail' },
        ];

        let activeLaunchedToys = [];
        let activePopParticles = []; 
        let floorBoundaryY; 

        function updateFloorBoundary() {
            if (toyBar) {
                floorBoundaryY = window.innerHeight - toyBar.offsetHeight;
            } else {
                floorBoundaryY = window.innerHeight; 
            }
        }

        function initToyBar() {
            toyDefinitions.forEach(toyDef => {
                const toyElement = document.createElement('div');
                toyElement.id = `bar-${toyDef.id}`;
                
                if (toyDef.emoji.trim().startsWith('<svg')) {
                    toyElement.innerHTML = toyDef.emoji;
                } else {
                    toyElement.textContent = toyDef.emoji;
                }
                
                toyElement.className = 'text-8xl sm:text-9xl cursor-pointer emoji-toy p-1 sm:p-2 select-none';
                toyElement.setAttribute('role', 'button');
                toyElement.setAttribute('aria-label', `Launch ${toyDef.id}`);

                const launchHandler = (e) => {
                    e.preventDefault(); 
                    handleToyTap(toyDef, toyElement);
                };
                toyElement.addEventListener('touchstart', launchHandler);
                toyElement.addEventListener('click', launchHandler); 
                toyBar.appendChild(toyElement);
            });
        }

        function handleToyTap(toyDef, originalBarElement) {
            if (toyDef.isRocket) {
                showCountdown(() => {
                    createAndLaunchToy(toyDef, originalBarElement, true);
                });
            } else {
                createAndLaunchToy(toyDef, originalBarElement, false);
            }
        }

        function showCountdown(callbackOnFinish) {
            countdownDisplay.classList.remove('hidden');
            let count = 3;
            countdownText.textContent = count;
            const interval = setInterval(() => {
                count--;
                if (count > 0) {
                    countdownText.textContent = count;
                } else if (count === 0) {
                    countdownText.textContent = 'GO!';
                } else {
                    clearInterval(interval);
                    countdownDisplay.classList.add('hidden');
                    if (callbackOnFinish) callbackOnFinish();
                }
            }, 800);
        }

        function createAndLaunchToy(toyDef, originalBarElement, isRocketLaunch) {
            const originalRect = originalBarElement.getBoundingClientRect();
            const launchedToyElement = document.createElement('div');

            if (toyDef.emoji.trim().startsWith('<svg')) {
                launchedToyElement.innerHTML = toyDef.emoji;
            } else {
                launchedToyElement.textContent = toyDef.emoji;
            }
            
            launchedToyElement.className = 'absolute text-8xl sm:text-9xl z-20 launched-toy select-none'; 
            gameArea.appendChild(launchedToyElement);

            const toyWidth = launchedToyElement.offsetWidth;
            const toyHeight = launchedToyElement.offsetHeight;
            
            let startX = originalRect.left + (originalRect.width / 2) - (toyWidth / 2);
            let startY = originalRect.top + (originalRect.height / 2) - (toyHeight / 2);

            if (startY + toyHeight > floorBoundaryY) {
                startY = floorBoundaryY - toyHeight - 10; 
            }

            launchedToyElement.style.left = `${startX}px`;
            launchedToyElement.style.top = `${startY}px`;

            let toyVx, toyVy;

            if (toyDef.movementType === 'float_gentle') {
                toyVx = (Math.random() - 0.5) * 1.2; 
                toyVy = -0.3 - Math.random() * 0.4; 
            } else if (toyDef.movementType === 'float_drift') {
                toyVx = (Math.random() - 0.5) * 1.5; 
                toyVy = (Math.random() - 0.5) * 1.5;
            } else { 
                toyVx = (Math.random() - 0.5) * HORIZONTAL_KICK_RANGE * 2;
                toyVy = isRocketLaunch ? ROCKET_LAUNCH_VY : INITIAL_KICK_VY;
            }

            const newToyData = {
                element: launchedToyElement,
                x: startX, y: startY,
                vx: toyVx, vy: toyVy,
                width: toyWidth, height: toyHeight, 
                isRocket: toyDef.isRocket,
                movementType: toyDef.movementType,
                particleEffect: toyDef.particleEffect,
                particles: toyDef.particleEffect === 'trail' ? [] : undefined,
                particleTimer: toyDef.particleEffect === 'trail' ? 0 : undefined,
            };
            activeLaunchedToys.push(newToyData);

            const popHandler = (e) => {
                e.preventDefault(); 
                popToy(newToyData);
            };
            launchedToyElement.addEventListener('touchstart', popHandler);
            launchedToyElement.addEventListener('click', popHandler); 
        }

        function popToy(toyToPop) {
            if (toyToPop.element.parentNode === gameArea) {
                gameArea.removeChild(toyToPop.element);
            }
            if (toyToPop.particleEffect === 'trail' && toyToPop.particles) {
                toyToPop.particles.forEach(p => {
                    if (p.element.parentNode === gameArea) {
                        gameArea.removeChild(p.element);
                    }
                });
                toyToPop.particles = []; 
            }
            createPopExplosion(toyToPop.x, toyToPop.y, toyToPop.width, toyToPop.height);
            try {
                const audio = new Audio('pop1.mp3'); 
                const playPromise = audio.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.warn("Audio play failed:", error);
                    });
                }
            } catch (e) {
                console.warn("Could not initialize or play pop sound.", e);
            }
            const index = activeLaunchedToys.indexOf(toyToPop);
            if (index > -1) {
                activeLaunchedToys.splice(index, 1);
            }
        }

        function createPopExplosion(x, y, width, height) {
            const centerX = x + width / 2;
            const centerY = y + height / 2;
            const colors = ['#FF5733', '#FFC300', '#DAF7A6', '#7DCEA0', '#5DADE2', '#C39BD3'];
            for (let i = 0; i < POP_PARTICLE_COUNT; i++) {
                const particleEl = document.createElement('div');
                particleEl.className = 'pop-particle';
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * POP_PARTICLE_SPEED + 1;
                const size = Math.random() * 6 + 4; 
                particleEl.style.width = `${size}px`;
                particleEl.style.height = `${size}px`;
                particleEl.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                particleEl.style.left = `${centerX - size / 2}px`;
                particleEl.style.top = `${centerY - size / 2}px`;
                particleEl.style.opacity = '1';
                gameArea.appendChild(particleEl);
                activePopParticles.push({
                    element: particleEl,
                    x: centerX - size / 2,
                    y: centerY - size / 2,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    life: POP_PARTICLE_LIFESPAN,
                    initialOpacity: 1,
                });
            }
        }

        function createStarParticle(starToy) {
            const particleEl = document.createElement('div');
            particleEl.className = 'particle'; 
            const size = Math.random() * 4 + 3; 
            particleEl.style.width = `${size}px`;
            particleEl.style.height = `${size}px`;
            particleEl.style.backgroundColor = `rgba(255, 215, 0, ${0.6 + Math.random() * 0.3})`; 
            particleEl.style.boxShadow = `0 0 ${Math.random()*3 + 2}px rgba(255, 223, 100, 0.7)`;
            const pData = {
                element: particleEl,
                x: starToy.x + starToy.width / 2 - size / 2 + (Math.random() - 0.5) * starToy.width * 0.3,
                y: starToy.y + starToy.height / 2 - size / 2 + (Math.random() - 0.5) * starToy.height * 0.3,
                vx: (Math.random() - 0.5) * 0.6, 
                vy: (Math.random() - 0.5) * 0.6,
                life: PARTICLE_LIFESPAN + Math.random() * 20, 
                initialOpacity: parseFloat(particleEl.style.backgroundColor.split(',')[3]) || 0.8 
            };
            particleEl.style.left = `${pData.x}px`;
            particleEl.style.top = `${pData.y}px`;
            particleEl.style.opacity = pData.initialOpacity;
            gameArea.appendChild(particleEl);
            starToy.particles.push(pData);
        }

        function updateStarParticles(starToy) {
            starToy.particleTimer = (starToy.particleTimer || 0) + 1;
            if (starToy.particles.length < MAX_PARTICLES_PER_STAR && starToy.particleTimer % PARTICLE_SPAWN_INTERVAL === 0) {
                createStarParticle(starToy);
            }
            for (let i = starToy.particles.length - 1; i >= 0; i--) {
                const p = starToy.particles[i];
                p.life--;
                p.x += p.vx;
                p.y += p.vy;
                const currentOpacity = (p.life / (PARTICLE_LIFESPAN + 20)) * p.initialOpacity;
                p.element.style.opacity = Math.max(0, currentOpacity);
                if (p.life <= 0 || currentOpacity <= 0) {
                    if (p.element.parentNode === gameArea) {
                         gameArea.removeChild(p.element);
                    }
                    starToy.particles.splice(i, 1);
                } else {
                    p.element.style.left = `${p.x}px`;
                    p.element.style.top = `${p.y}px`;
                }
            }
        }

        // Fullscreen Logic
        function toggleFullScreen() {
            if (!document.fullscreenElement && 
                !document.mozFullScreenElement && 
                !document.webkitFullscreenElement && 
                !document.msFullscreenElement) {  // Currentlly not in fullscreen
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                } else if (document.documentElement.msRequestFullscreen) {
                    document.documentElement.msRequestFullscreen();
                } else if (document.documentElement.mozRequestFullScreen) {
                    document.documentElement.mozRequestFullScreen();
                } else if (document.documentElement.webkitRequestFullscreen) {
                    document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
                }
            }
            // No "else" to exit fullscreen, as per requirement (user uses ESC)
        }

        function handleFullscreenChange() {
            if (document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement || document.msFullscreenElement) {
                fullscreenButton.style.display = 'none'; // Hide button in fullscreen
            } else {
                fullscreenButton.style.display = 'block'; // Show button when not in fullscreen
            }
        }

        fullscreenButton.addEventListener('click', toggleFullScreen);
        // Listen for fullscreen changes on the document
        document.addEventListener('fullscreenchange', handleFullscreenChange);
        document.addEventListener('mozfullscreenchange', handleFullscreenChange);
        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
        document.addEventListener('msfullscreenchange', handleFullscreenChange);


        function gameLoop() {
            const gameAreaWidth = window.innerWidth;
            activeLaunchedToys.forEach(toy => {
                if (toy.movementType === 'bounce') {
                    toy.vy += GRAVITY;
                    toy.x += toy.vx;
                    toy.y += toy.vy;
                    if (toy.x < 0) { toy.x = 0; toy.vx *= -BOUNCE_DAMPING; }
                    if (toy.x + toy.width > gameAreaWidth) { toy.x = gameAreaWidth - toy.width; toy.vx *= -BOUNCE_DAMPING; }
                    if (toy.y < 0) { toy.y = 0; toy.vy *= -BOUNCE_DAMPING; }
                    if (toy.y + toy.height > floorBoundaryY) {
                        toy.y = floorBoundaryY - toy.height;
                        toy.vy *= -BOUNCE_DAMPING;
                        toy.vx *= 0.98; 
                        if (Math.abs(toy.vy) < GRAVITY * 1.5) toy.vy = 0; 
                    }
                } else if (toy.movementType === 'float_gentle') { 
                    toy.vx += (Math.random() - 0.5) * 0.08;
                    toy.vy += (Math.random() - 0.5) * 0.03 - 0.005; 
                    toy.vx = Math.max(-1, Math.min(1, toy.vx));
                    toy.vy = Math.max(-0.8, Math.min(0.2, toy.vy)); 
                    toy.x += toy.vx;
                    toy.y += toy.vy;
                    if (toy.x < 0 && toy.vx < 0) { toy.vx *= -0.8; toy.x = 0;}
                    if (toy.x + toy.width > gameAreaWidth && toy.vx > 0) { toy.vx *= -0.8; toy.x = gameAreaWidth - toy.width; }
                    if (toy.y < 0 && toy.vy < 0) { toy.vy *= -0.8; toy.y = 0; }
                    if (toy.y + toy.height > floorBoundaryY && toy.vy > 0) { toy.vy *= -0.8; toy.y = floorBoundaryY - toy.height; }
                } else if (toy.movementType === 'float_drift') { 
                    if (Math.random() < 0.015) toy.vx = (Math.random() - 0.5) * 2; 
                    if (Math.random() < 0.015) toy.vy = (Math.random() - 0.5) * 2; 
                    toy.vx = Math.max(-1.5, Math.min(1.5, toy.vx));
                    toy.vy = Math.max(-1.5, Math.min(1.5, toy.vy));
                    toy.x += toy.vx;
                    toy.y += toy.vy;
                    if (toy.x < 0 && toy.vx < 0) { toy.vx *= -1; toy.x = 0; }
                    if (toy.x + toy.width > gameAreaWidth && toy.vx > 0) { toy.vx *= -1; toy.x = gameAreaWidth - toy.width; }
                    if (toy.y < 0 && toy.vy < 0) { toy.vy *= -1; toy.y = 0; }
                    if (toy.y + toy.height > floorBoundaryY && toy.vy > 0) { toy.vy *= -1; toy.y = floorBoundaryY - toy.height; }
                    if (toy.particleEffect === 'trail') {
                        updateStarParticles(toy);
                    }
                }
                toy.element.style.left = `${toy.x}px`;
                toy.element.style.top = `${toy.y}px`;
            });

            for (let i = activePopParticles.length - 1; i >= 0; i--) {
                const p = activePopParticles[i];
                p.life--;
                p.x += p.vx;
                p.y += p.vy;
                p.vy += GRAVITY * 0.1; 
                const currentOpacity = (p.life / POP_PARTICLE_LIFESPAN) * p.initialOpacity;
                p.element.style.opacity = Math.max(0, currentOpacity);
                if (p.life <= 0 || currentOpacity <= 0) {
                    if (p.element.parentNode === gameArea) {
                        gameArea.removeChild(p.element);
                    }
                    activePopParticles.splice(i, 1);
                } else {
                    p.element.style.left = `${p.x}px`;
                    p.element.style.top = `${p.y}px`;
                }
            }
            requestAnimationFrame(gameLoop);
        }

        initToyBar();
        updateFloorBoundary(); 
        requestAnimationFrame(gameLoop);

        window.addEventListener('resize', () => {
            updateFloorBoundary(); 
            // Potentially adjust toy positions if resize makes them go out of bounds
            // or if fullscreen change significantly alters layout. For now, keeping it simple.
        });
    </script>
</body>
</html>